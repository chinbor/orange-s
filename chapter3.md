# Third Chapter

#### 07c00h是什么意思？

> #### FFFF0h与07C00h，这两个都是机器启动后默认访问的内存地址。
>
> #### 首先要知道bios是用来初始化硬件的最底层的软件（然后才是操作系统），因此计算机启动后必须最先被执行。另外我们都知道CPU只能执行内存中的内容的，而一般内存中的数据是易失性的，断电之后内容就会消失。工程师的解决方法是：将存放bios的rom芯片与内存芯片统一编址（不明白的话去看看微机原理与接口的书就明白了）。这样就可以把存放bios的ROM芯片看作是数据永远不会消失不允许被更改的内存了。
>
> #### 开机启动后默认的CS=FFFFh  IP=0000h。这个地址就是bios的地址。这段内存空间很小，所以不能够容下操作系统等大型程序。
>
> #### 相对bios而言操作系统的功能更强大，更新也更快但是也需要更多的空间，通常放在硬盘中。但是如果没有bios的话，那么将会连硬盘都不能使用，又如何启动存放在硬盘中的操作系统呢？正是由于此，机器启动后自动执行bios使其它完成硬件初始化（这样包括硬盘在内的cpu以外的其他硬件设备就可以工作了）。bios完成硬件初始化的任务后，就要把权力移交给操作系统。
>
> #### 工程师进行了强制性的规定：到内存中的07c00h 处寻找系统的引导程序，即CS=0000h IP=7c00h。也就是说任何系统，他的引导程序都必须安排在07c00h开始的地方，否则就不能被正确的引导。当引导程序完成后我们就进入了 Linux Windows等系统了。

#### A20地址线

> #### 地址回绕
>
> ####        早期的8086只有20根地址线，只能访问1M的地址空间。CPU寻址则按段+偏移的方式进行。16位段+16位偏移的可能的范围是 0~0x10FFEF（即0xFFFF0+0xFFFF），即1M+65520字节的范围。由于只有20根地址线，所以在对1M~1M+65520范围进行访问时，会发生“地址回绕”的现象，就是说实际会访问到0~65520的地方。据说某个著名的/臭名昭著的软件利用了这个特点。在80286，386等 CPU上，它会失败，因为这些CPU有多于20根的地址线，并不产生“地址回绕”现象。为了保持完全的兼容性，IBM决定在PC AT系统上加个逻辑，来模仿以上的回绕特征。他们的方法就是把A20和键盘控制器的一个输出进行AND，这样来控制A20的打开和关闭。一开始时A20是被屏蔽的（总为0），直到系统软件去打开它。
>
> #### A20地址线       1981年8月，IBM公司最初推出的个人计算机IBM PC使用的CPU是Intel 8088。在该微机中地址线只有20根\(A0 – A19\)。在当时内存RAM只有几百KB或不到1MB时，20根地址线已足够用来寻址这些内存。其所能寻址的最高地址是0xffff:0xffff，也即 0x10ffef。对于超出0x100000\(1MB\)的寻址地址将默认地环绕到0x0ffef。当IBM公司于1985年引入AT机时，使用的是 Intel 80286 CPU，具有24根地址线，最高可寻址16MB，并且有一个与8088完全兼容的实模式运行方式。然而，在寻址值超过1MB时它却不能象8088那样实现地址寻址的环绕。但是当时已经有一些程序是利用这种地址环绕机制进行工作的。为了实现完全的兼容性，IBM公司发明了使用一个开关来开启或禁止 0x100000地址比特位。由于在当时的8042键盘控制器上恰好有空闲的端口引脚（输出端口P2，引脚P21），于是便使用了该引脚来作为与门控制这个地址比特位。该信号即被称为A20。如果它为零，则比特20及以上地址都被清除。从而实现了兼容性。        由于在机器启动时，默认条件下，A20地址线是禁止的，所以操作系统必须使用适当的方法来开启它。但是由于各种兼容机所使用的芯片集不同，要做到这一点却是非常的麻烦。因此通常要在几种控制方法中选择。
>
> ####         对A20信号线进行控制的常用方法是通过设置键盘控制器的端口值。 有些操作系统将A20的开启和禁止作为实模式与保护运行模式之间进行转换的标准过程中的一部分。       由于键盘的控制器速度很慢，因此就不能使用键盘控制器对A20线来进行操作。为此引进了一个A20快速门选项\(Fast Gate A20\)，它使用I/O端口0x92来处理A20信号线，避免了使用慢速的键盘控制器操作方式。对于不含键盘控制器的系统就只能使用0x92端口来控制，但是该端口也有可能被其它兼容微机上的设备（如显示芯片）所使用，从而造成系统错误的操作。         还有一种方式是通过读0xee端口来开启A20信号线，写该端口则会禁止A20信号线。



