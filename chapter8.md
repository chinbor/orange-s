# Eighth Chapter

### 一. 8253/8254定时器

#### 1. 8253/8254 的内部结构

![](https://img-blog.csdn.net/20151226161454906)
1.1 数据总线缓冲器 

> 8 位双向三态缓冲器，用于连接系统数据总线和8253 内部总线。以便编程时:
* 处理器对8253写入控制字
* 处理器写入计数初值
* 处理器从计数器读取计数值。

1.2 读/写控制逻辑 
> 8253 内部的控制电路，读写逻辑接收来自CPU 的控制信号，经过组合，产生对8253各部分的控制。具体为：
* A1 、A0——用来对3个计数器和控制字存器进行寻址。
* RD——读信号。当RD为低电平时有效，此时，表示CPU正在对8253的一个计数器进行读操作。
* WR——写信号。当WR为低电平时有效，此时，表示CPU正在对8253的几个计数器进行写操作。
* CS——片选信号。只有在CS为持续低电平的情况下，RD和WR才会受到确认，否则会被忽略。

1.3 控制字寄存器
> 控制字寄存器接收CPU 送来的控制字，决定每个计数器的工作方式、读写格式和计数的数制。当A1A0=11 时，用来接收CPU 输出的控制字。该寄存器是个只能写入寄存器。

1.4 计数器（计数器0、计数器计1、数器2） 
> 8253 内部有3 个相互独立且结构功能完全相同的定时/计数器：0、1 和2。每个计数器包含一个控制字寄存器、16 位的初值寄存器CR（Count Register）、减“1”计数器CE（Counting Element）和16 位输出锁存寄存器OL（Out put Latch）。

> 减“1”计数器的初始值由程序设定，是初值寄存器的内容。计数器的当前值存放在输出锁存寄存器，CPU 可以在需要的时候读出这个值。
![](https://img-blog.csdn.net/20151226162015115)
每个计数器有3 根信号线：时钟输入信号CLK、门控信号输入GATE 和输出信号OUT。

> 计数器工作时，每出现一个CLK脉冲**(具体说是第一个下降沿是将cr寄存器的内容取到ce寄存器，第二个clk下降沿才减一)**，减“1”计数器中的计数值减1，当计数值减为0 时，通过OUT 输出结束信号，表明计数执行单元已为0，输出信号的波形由工作方式确定。当CLK是一个周期性的时钟信号时，计数器为定时器功能；当CLK是一个非周期性事件计数信号时，此时为计数器功能。8253 的定时时间取决于时钟脉冲的频率和计数器的初值：
 ```
                     定时时间T = 时钟脉冲周期tc × 计数初值n 
 ```
 此外，可以通过GATE 引脚上的门控信号允许或停止计数器的过程。

#### 2. 8253 的外部引脚
* D7 ～D0：双向数据线，与系统数据总线相连，供CPU 对8253 进行读/写操作，进行信息交换。
* CS：片选线，输入低电平有效。当CS= 0 时，表示CPU 选中8253 芯片，可对8253 进行读/写操作；当CS= 1 时，表示CPU 未选中8253 芯片。CS信号是由CPU 输出的高位地址（通常A9A9～A2A2）和AEN 信号经过电路译码后产生。
* A1 ～A0：地址输入信号，用于选择8253 内部寄存器。当CS为低电平有效时，选中8253芯片，然后通过A1 A0 组合编码决定选中计数器 
> ![](https://img-blog.csdn.net/20151226163142674)

* RD 和WR ：读/写控制输入信号端，低电平有效。当CS= 0，RD= 0 时，表示CPU 可对8253 的一个计数器进行读操作；当CS= 0，WR = 0 时，表示CPU 可对8253 的一个计数器或控制字寄存器进行写操作。
* GATE ：门控输入信号。是一根外部控制计数器工作的输入信号线，用作控制启动或中止定时/计数。对于8253 这6 种不同的工作方式，GATE 信号的有效方式也不同，可以是上升沿信号有效或是电平信号有效。
* CLK：外部脉冲信号输入端CLK0、CLK1、CLK2，分别为计数器0、计数器1、计数器2的脉冲信号输入端。计数器对该引脚输入的脉冲信号进行计数，CLK脉冲信号可以由系统时钟、系统时钟分频或者其他脉冲源提供。CLK 输入脉冲可以是均匀的、连续的或周期精确的信号，也可以是不均匀的、不连续的或非周期的信号。如果输入脉冲是精确的时钟信号，则8253 起定时作用；如果输入脉冲是非周期的信号，则8253 起计数作用。
* OUT ：定时时间到或计数减为零的向外输出信号端OUT0、OUT1、OUT2，分别为计数器0、计数器1、计数器2 的脉冲信号输出端。无论8253 的计数器工作在什么方式，当计数器减到0 时，信号输出端OUT 必定有一个电平或脉冲信号输出，用以指示定时时间到或者计数结束。该信号可供CPU 检测，也可以作为中断请求信号。

#### 3. 8253/8254 的工作方式
* 方式0：计数结束产生中断
* 方式1：可编程单稳态触发器
* ** 方式2：分频器（Rate Generator）**
* 方式3：方波发生器
* 方式4：软件触发选通脉冲
* 方式5：硬件触发选通脉冲
### 二. 8259a可编程中断控制器

原文：https://blog.csdn.net/u013007900/article/details/50408903 




